<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Leshi Chen, Del Robinson, and Pubudu Senanayake" />

<meta name="date" content="2020-05-08" />

<title>Rules Based Classification for Migration</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Rules Based Classification for Migration</h1>
<h4 class="author">Leshi Chen, Del Robinson, and Pubudu Senanayake</h4>
<h4 class="date">2020-05-08</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This package provides mechanisms for classifying border crossings using a rules-based methodology. The goal of performing this type of classification is to identify any potential long-term migrants. A long-term migration is defined as a border crossing involving a change in residence status. A border crossing counts as a long-term migration to/from a country if it entails a change from non-residence to residence or residence to non-residence. The rules-based classification that used to determine a long-term migration is defined by a threshold duration and a test duration, alternatively named window size. Under a 12/16 rule, for instance, the threshold duration is 12 months and the test duration (window size) is 16 months. With a 9/12 rule, the threshold duration is 9 months and the test duration (window size) is 12 months. This vignette demonstrates the use of the functions, by calculating the days of residence and migration statuses, with a small made-up set of border crossings. For more information about the methodology applied, please visit Stats NZ (2020) <a href="https://www.stats.govt.nz/methods/defining-migrants-using-travel-histories-and-the-1216-month-rule" class="uri">https://www.stats.govt.nz/methods/defining-migrants-using-travel-histories-and-the-1216-month-rule</a>.</p>
</div>
<div id="outcome-based-rules-for-classifying-migration" class="section level1">
<h1>Outcome-based rules for classifying migration</h1>
<p>Rules based classification simultaneously assign residence status and migration status, based on the direction of the border crossing, the person’s residence status before the crossing, and the length of time spent in or out of the country after the crossing. Obviously, the Outcome-based rules need to deal simultaneously with two sorts of units: border crossings and people, and hence, the input data must contain information about the two units. The following outlines the main table structure of the input data.</p>
<div id="the-format-of-input-data-border-crossing-information-data" class="section level3">
<h3>The format of input data (Border Crossing Information data):</h3>
<div class="l-body-outset">
<table>
<colgroup>
<col width="14%"></col>
<col width="13%"></col>
<col width="15%"></col>
<col width="18%"></col>
<col width="21%"></col>
<col width="18%"></col>
</colgroup>
<thead>
<tr class="header">
<th><strong>journeyId</strong></th>
<th><strong>personId</strong></th>
<th><strong>is_arrival</strong></th>
<th><strong>date_crossing</strong></th>
<th><strong>journey_sequence</strong></th>
<th><strong>journeyId_prev</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&lt;Integer&gt;</code></td>
<td><code>&lt;Integer&gt;</code></td>
<td><code>&lt;Integer&gt;</code></td>
<td><code>&lt;Character&gt;</code></td>
<td><code>&lt;Integer&gt;</code></td>
<td><code>&lt;Integer&gt;</code></td>
</tr>
<tr class="even">
<td><code>The id of a journey</code></td>
<td><code>The id of a person</code></td>
<td><code>The direction of the border crossing, i.e., 0:departure, 1:arrival</code></td>
<td><code>The date of border crossing, such as 2012-01-01</code></td>
<td><code>The order of multiple journeys made by the person</code></td>
<td><code>The previous journey id</code></td>
</tr>
</tbody>
</table>
</div>
<p>Sometimes, a piece of data about residences’ initial status is required. A residence initial status is referred to as the residence status before he/she made the first journey in the target country, i.e., New Zealand.</p>
</div>
<div id="the-format-of-initial-residence-status-data" class="section level3">
<h3>The format of initial residence status data:</h3>
<div class="l-body-outset">
<table>
<colgroup>
<col width="25%"></col>
<col width="42%"></col>
<col width="32%"></col>
</colgroup>
<thead>
<tr class="header">
<th><strong>personId </strong></th>
<th><strong>res_status_initial </strong></th>
<th><strong>date_finalised</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&lt;Integer&gt;</code></td>
<td><code>&lt;Integer&gt;</code></td>
<td><code>&lt;Character&gt;</code></td>
</tr>
<tr class="even">
<td><code>The id of a person</code></td>
<td><code>The initial residence status: 0: Non-resident, 1: resident</code></td>
<td><code>The date of the residence status confirmed, such as 2010-01-01</code></td>
</tr>
</tbody>
</table>
</div>
<p>A comprehensive rules-based methodology is outlined as follows:</p>
</div>
<div id="rbc-algorithm-as-pseudo-code" class="section level2">
<h2>RBC algorithm as pseudo code</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="op">---</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">Terms<span class="op">:</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="st">  </span>Rb<span class="op">:</span><span class="st">  </span>resident status before <span class="op">-</span><span class="st"> </span>Resident or NonResident</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  Ra<span class="op">:</span><span class="st">  </span>resident status after <span class="op">-</span><span class="st"> </span>Resident or NonResident</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  LTM<span class="op">:</span><span class="st"> </span>Long term migration <span class="op">-</span><span class="st"> </span>true or false</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  Journey<span class="op">:</span><span class="st"> </span>Travel movement of a person involving a border crossing<span class="op">:</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="st">           </span>Depart or Arrive</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"> </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">Define Parameters<span class="op">:</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st">  </span>Tw<span class="op">:</span><span class="st"> </span>Window size <span class="op">-</span><span class="st"> </span>the maximum number of days within which the resident status of </a>
<a class="sourceLine" id="cb1-11" data-line-number="11">      the [persons journey] is <span class="kw">resolved</span> (specified as <span class="dv">487</span> days).</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  Tm<span class="op">:</span><span class="st"> </span>Threshold <span class="cf">for</span> Accumulated days [outside the country as departed]. It is </a>
<a class="sourceLine" id="cb1-13" data-line-number="13">      required <span class="cf">for</span> <span class="kw">Migration</span> (specified as <span class="dv">365</span> days).</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"> </a>
<a class="sourceLine" id="cb1-15" data-line-number="15">Derived Parameters<span class="op">:</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="st">  </span>Tn<span class="op">:</span><span class="st"> </span>Threshold <span class="cf">for</span> Accumulated days required <span class="cf">for</span> Non<span class="op">-</span><span class="kw">Migration</span> (Tw<span class="op">-</span>Tm). Journey</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">      stays within resident <span class="kw">country</span> (derived as <span class="dv">122</span> days).</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">  Ts<span class="op">:</span><span class="st"> </span>Threshold <span class="cf">for</span> instant assignment of non<span class="op">-</span>migration <span class="cf">for</span> successive return </a>
<a class="sourceLine" id="cb1-19" data-line-number="19">      <span class="kw">journeys</span> (Tw<span class="op">-</span>Tm)<span class="kw">x2</span> (derived as <span class="dv">244</span> days).</a>
<a class="sourceLine" id="cb1-20" data-line-number="20"> </a>
<a class="sourceLine" id="cb1-21" data-line-number="21">Define the Input Set<span class="op">:</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="st">  </span>Attributes of the person are</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">    <span class="op">-</span><span class="st"> </span>residence status before</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    <span class="op">-</span><span class="st"> </span>date resolved residence status before -&gt;<span class="st"> </span>date Rb</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    <span class="op">-</span><span class="st"> </span>list of journeys arranged <span class="cf">in</span> time ascending order</a>
<a class="sourceLine" id="cb1-26" data-line-number="26"> </a>
<a class="sourceLine" id="cb1-27" data-line-number="27">  Attributes of each journey are</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">    <span class="op">-</span><span class="st"> </span>journey <span class="kw">identifier</span> (JID)</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">    <span class="op">-</span><span class="st"> </span>date of crossing</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">    <span class="op">-</span><span class="st"> </span>direction</a>
<a class="sourceLine" id="cb1-31" data-line-number="31"> </a>
<a class="sourceLine" id="cb1-32" data-line-number="32">  Working Values <span class="cf">for</span> each journey</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">    <span class="op">-</span><span class="st"> </span>duration</a>
<a class="sourceLine" id="cb1-34" data-line-number="34"> </a>
<a class="sourceLine" id="cb1-35" data-line-number="35">  Final Results</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">    <span class="op">-</span><span class="st"> </span>journey <span class="kw">identifier</span> (JID)</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">    <span class="op">-</span><span class="st"> </span>prev journey <span class="kw">identifier</span> (prev JID)</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">    <span class="op">-</span><span class="st"> </span>residence status <span class="kw">before</span> (Rb)</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">    <span class="op">-</span><span class="st"> </span>residence status <span class="kw">after</span> (Ra)</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">    <span class="op">-</span><span class="st"> </span>long term migrant -&gt;<span class="st"> </span>LTM  <span class="co">## or Rb or  Ra</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41">    <span class="op">-</span><span class="st"> </span>date resolved residence status before -&gt;<span class="st"> </span>date Rb</a>
<a class="sourceLine" id="cb1-42" data-line-number="42">    <span class="op">-</span><span class="st"> </span>date resolved residence status after -&gt;<span class="st"> </span>date Ra</a>
<a class="sourceLine" id="cb1-43" data-line-number="43">    <span class="op">-</span><span class="st"> </span>date resolved long term migrant -&gt;<span class="st"> </span>date LTM</a>
<a class="sourceLine" id="cb1-44" data-line-number="44"> </a>
<a class="sourceLine" id="cb1-45" data-line-number="45"> </a>
<a class="sourceLine" id="cb1-46" data-line-number="46">Algorithm<span class="op">:</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="st">  </span><span class="co">## We calculate the outcomes for a single person</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"><span class="st">  </span><span class="co">## pre-check and assignment</span></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="st">  </span><span class="co">## check the provided journey list is a valid sequence and assign duration for</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="st">  </span><span class="co">## each journey.</span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="st">  </span>For each journey <span class="cf">in</span> list of journeys</a>
<a class="sourceLine" id="cb1-52" data-line-number="52">      <span class="co">## arrive / arrive OR depart / depart</span></a>
<a class="sourceLine" id="cb1-53" data-line-number="53">      <span class="cf">if</span> the journey direction has not changed from prior journey</a>
<a class="sourceLine" id="cb1-54" data-line-number="54">          then raise error</a>
<a class="sourceLine" id="cb1-55" data-line-number="55">      <span class="co">## 0 if same day</span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56">      journey.duration is days elapsed until <span class="cf">next</span> journey </a>
<a class="sourceLine" id="cb1-57" data-line-number="57">      <span class="co">## artificial to make later calculations easier</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58">      <span class="cf">if</span> this is the last journey then duration is set to Tw </a>
<a class="sourceLine" id="cb1-59" data-line-number="59">   </a>
<a class="sourceLine" id="cb1-60" data-line-number="60">     journey.prev journey id is the prior journey.journey id</a>
<a class="sourceLine" id="cb1-61" data-line-number="61"> </a>
<a class="sourceLine" id="cb1-62" data-line-number="62"> </a>
<a class="sourceLine" id="cb1-63" data-line-number="63">  <span class="co">## Run Main Calculations</span></a>
<a class="sourceLine" id="cb1-64" data-line-number="64">  For each journeyUnderReview <span class="cf">in</span> list of journeys</a>
<a class="sourceLine" id="cb1-65" data-line-number="65">      <span class="co">## the resident status before of this journey is the resident status </span></a>
<a class="sourceLine" id="cb1-66" data-line-number="66">      <span class="co">## after of the prior journey or person if first journey</span></a>
<a class="sourceLine" id="cb1-67" data-line-number="67">      <span class="cf">if</span> first journey</a>
<a class="sourceLine" id="cb1-68" data-line-number="68">         journeyUnderReview.[resident status before] =<span class="st"> </span>person.</a>
<a class="sourceLine" id="cb1-69" data-line-number="69">         journeyUnderReview.[date Rb] =<span class="st"> </span>person.[date Rb]</a>
<a class="sourceLine" id="cb1-70" data-line-number="70">      <span class="cf">else</span></a>
<a class="sourceLine" id="cb1-71" data-line-number="71">         journeyUnderReview.[resident status before] =<span class="st"> </span>previousJourney.</a>
<a class="sourceLine" id="cb1-72" data-line-number="72">         journeyUnderReview.[date Rb] =<span class="st"> </span>previousJourney.[date Ra]</a>
<a class="sourceLine" id="cb1-73" data-line-number="73">   </a>
<a class="sourceLine" id="cb1-74" data-line-number="74">      <span class="co">## Step 1 of 3 - find our migration direction status</span></a>
<a class="sourceLine" id="cb1-75" data-line-number="75">   </a>
<a class="sourceLine" id="cb1-76" data-line-number="76">      <span class="cf">if</span> (journeyUnderReview.[direction] is Depart AND </a>
<a class="sourceLine" id="cb1-77" data-line-number="77">         journeyUnderReview.[resident status before] is Resident)</a>
<a class="sourceLine" id="cb1-78" data-line-number="78">         <span class="kw">OR</span> (journeyUnderReview.[direction] is Arrive </a>
<a class="sourceLine" id="cb1-79" data-line-number="79">         AND journeyUnderReview.[resident status before] is NonResident)</a>
<a class="sourceLine" id="cb1-80" data-line-number="80">         </a>
<a class="sourceLine" id="cb1-81" data-line-number="81">         JourneyMigrationDirection =<span class="st"> </span>Migration</a>
<a class="sourceLine" id="cb1-82" data-line-number="82">      <span class="cf">else</span></a>
<a class="sourceLine" id="cb1-83" data-line-number="83">         JourneyMigrationDirection =<span class="st"> </span>Non<span class="op">-</span>Migration</a>
<a class="sourceLine" id="cb1-84" data-line-number="84">   </a>
<a class="sourceLine" id="cb1-85" data-line-number="85">      <span class="co">## Step 2 of 3 - look ahead to set *instant* LTM. These set LTM = false for</span></a>
<a class="sourceLine" id="cb1-86" data-line-number="86">      <span class="co">## any qualifying journeys basically any journey which is a return (Arrive</span></a>
<a class="sourceLine" id="cb1-87" data-line-number="87">      <span class="co">## for resident OR depart for NonResident) within Ts days of date of crossing</span></a>
<a class="sourceLine" id="cb1-88" data-line-number="88">      <span class="co">## of JourneyUnderReview do a look ahead to see if any Ts threshold for </span></a>
<a class="sourceLine" id="cb1-89" data-line-number="89">      <span class="co">## instant non-migrations can be set.</span></a>
<a class="sourceLine" id="cb1-90" data-line-number="90">   </a>
<a class="sourceLine" id="cb1-91" data-line-number="91">      <span class="cf">if</span> JourneyMigrationDirection =<span class="st"> </span>Migration</a>
<a class="sourceLine" id="cb1-92" data-line-number="92">         <span class="cf">for</span> each journey <span class="cf">in</span> list of journeys starting from the journeyUnderReview</a>
<a class="sourceLine" id="cb1-93" data-line-number="93">             <span class="cf">if</span> journey.[date crossing] <span class="op">&gt;</span><span class="st"> </span>journeyUnderReview.[date crossing] <span class="op">+</span><span class="st"> </span>Ts</a>
<a class="sourceLine" id="cb1-94" data-line-number="94">                Exit <span class="cf">for</span> loop</a>
<a class="sourceLine" id="cb1-95" data-line-number="95">                </a>
<a class="sourceLine" id="cb1-96" data-line-number="96">             <span class="co">## The journeyUnderReview is in migration direction and journey is a </span></a>
<a class="sourceLine" id="cb1-97" data-line-number="97">             <span class="co">## return.</span></a>
<a class="sourceLine" id="cb1-98" data-line-number="98">             <span class="cf">if</span> journey.[sequence] is Even </a>
<a class="sourceLine" id="cb1-99" data-line-number="99">                 journey.[long term migration] =<span class="st"> </span>false</a>
<a class="sourceLine" id="cb1-100" data-line-number="100">                 journey.[date LTM] =<span class="st"> </span><span class="kw">maximum</span> ( journey.[date of crossing] )</a>
<a class="sourceLine" id="cb1-101" data-line-number="101">                                      <span class="kw">and</span> ( journeyUnderReview.[date Rb] )</a>
<a class="sourceLine" id="cb1-102" data-line-number="102">   </a>
<a class="sourceLine" id="cb1-103" data-line-number="103">   </a>
<a class="sourceLine" id="cb1-104" data-line-number="104">       <span class="co">## Step 3.1 of 3 - resolve the JourneyUnderReview – Non-Migrating direction</span></a>
<a class="sourceLine" id="cb1-105" data-line-number="105">       <span class="co">## Non Migrating direction calculation is simple – the journey is not</span></a>
<a class="sourceLine" id="cb1-106" data-line-number="106">       <span class="co">## a migration.</span></a>
<a class="sourceLine" id="cb1-107" data-line-number="107">       <span class="cf">if</span> JourneyMigrationDirection =<span class="st"> </span>Non<span class="op">-</span>Migration</a>
<a class="sourceLine" id="cb1-108" data-line-number="108">          <span class="kw">AssignNoMigration</span> ( journeyUnderReview, <span class="dv">0</span> )</a>
<a class="sourceLine" id="cb1-109" data-line-number="109">  </a>
<a class="sourceLine" id="cb1-110" data-line-number="110">       <span class="co">## Step 3.2 of 3 - resolve the JourneyUnderReview – Migrating direction</span></a>
<a class="sourceLine" id="cb1-111" data-line-number="111">       <span class="co">## For the journey under review (assume = #1), odd successive journeys </span></a>
<a class="sourceLine" id="cb1-112" data-line-number="112">       <span class="co">## contribute to days migrating and even journeys contribute to days</span></a>
<a class="sourceLine" id="cb1-113" data-line-number="113">       <span class="co">## not migrating. Now we loop through successive journeys to this one and</span></a>
<a class="sourceLine" id="cb1-114" data-line-number="114">       <span class="co">## accumulate days migrating and days non migrating.</span></a>
<a class="sourceLine" id="cb1-115" data-line-number="115"></a>
<a class="sourceLine" id="cb1-116" data-line-number="116">       <span class="cf">if</span> JourneyMigrationDirection =<span class="st"> </span>Migration</a>
<a class="sourceLine" id="cb1-117" data-line-number="117">          <span class="cf">for</span> each journey <span class="cf">in</span> list of journeys starting from the journeyUnderReview</a>
<a class="sourceLine" id="cb1-118" data-line-number="118">              AccumulatedDaysMigration =<span class="st"> </span>cumulative <span class="kw">sum</span> (odd journey duration)</a>
<a class="sourceLine" id="cb1-119" data-line-number="119">              AccumulatedDaysNoMigration =<span class="st"> </span>cumulative <span class="kw">sum</span> (even journey duration)</a>
<a class="sourceLine" id="cb1-120" data-line-number="120">   </a>
<a class="sourceLine" id="cb1-121" data-line-number="121">              <span class="co">## eventually one of the conditions will be met</span></a>
<a class="sourceLine" id="cb1-122" data-line-number="122">              <span class="cf">if</span> AccumulatedDaysMigration <span class="op">&gt;=</span><span class="st"> </span>Tm </a>
<a class="sourceLine" id="cb1-123" data-line-number="123">                 <span class="kw">AssignMigration</span>(journeyUnderReview, AccumulatedDaysNoMigration) </a>
<a class="sourceLine" id="cb1-124" data-line-number="124">                 and exit <span class="cf">for</span> loop</a>
<a class="sourceLine" id="cb1-125" data-line-number="125">              <span class="cf">if</span> AccumulatedDaysNoMigration <span class="op">&gt;=</span><span class="st"> </span>Tn </a>
<a class="sourceLine" id="cb1-126" data-line-number="126">                 <span class="kw">AssignNoMigration</span>(journeyUnderReview, AccumulatedDaysMigration)</a>
<a class="sourceLine" id="cb1-127" data-line-number="127">                 and exit <span class="cf">for</span> loop</a>
<a class="sourceLine" id="cb1-128" data-line-number="128">   </a>
<a class="sourceLine" id="cb1-129" data-line-number="129">       <span class="co">## journeyUnderReview has been resolved </span></a>
<a class="sourceLine" id="cb1-130" data-line-number="130">       add journeyUnderReview to results</a>
<a class="sourceLine" id="cb1-131" data-line-number="131">   </a>
<a class="sourceLine" id="cb1-132" data-line-number="132">       <span class="co">## setup for next loop</span></a>
<a class="sourceLine" id="cb1-133" data-line-number="133">       previousJourney =<span class="st"> </span>journeyUnderReview</a>
<a class="sourceLine" id="cb1-134" data-line-number="134"> </a>
<a class="sourceLine" id="cb1-135" data-line-number="135"> </a>
<a class="sourceLine" id="cb1-136" data-line-number="136">Sub Routines <span class="cf">for</span> Clarity</a>
<a class="sourceLine" id="cb1-137" data-line-number="137"> </a>
<a class="sourceLine" id="cb1-138" data-line-number="138">  <span class="kw">AssignMigration</span> ( journeyUnderReview, AccumulatedDaysNoMigration )</a>
<a class="sourceLine" id="cb1-139" data-line-number="139">      <span class="co">## migration has happened so LTM is true and residence status is flipped</span></a>
<a class="sourceLine" id="cb1-140" data-line-number="140">      journeyUnderReview.[long term migration] =<span class="st"> </span>true</a>
<a class="sourceLine" id="cb1-141" data-line-number="141">      journeyUnderReview.[date LTM] =<span class="st"> </span>crossing date <span class="op">+</span><span class="st"> </span>Tm <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-142" data-line-number="142"><span class="st">        </span>AccumulatedDaysNoMigration</a>
<a class="sourceLine" id="cb1-143" data-line-number="143">      journeyUnderReview.[resident status after] =<span class="st"> </span>opposite of journeyUnderReview.</a>
<a class="sourceLine" id="cb1-144" data-line-number="144">      journeyUnderReview.[date Ra] =<span class="st"> </span>journeyUnderReview.[date LTM]</a>
<a class="sourceLine" id="cb1-145" data-line-number="145">   </a>
<a class="sourceLine" id="cb1-146" data-line-number="146">  <span class="kw">AssignNoMigration</span> ( journeyUnderReview, AccumulatedDaysMigration )</a>
<a class="sourceLine" id="cb1-147" data-line-number="147">      <span class="co">## No migration has happened so LTM is false and residence status stays same</span></a>
<a class="sourceLine" id="cb1-148" data-line-number="148">      journeyUnderReview.[resident status after]=<span class="st"> </span>journeyUnderReview.</a>
<a class="sourceLine" id="cb1-149" data-line-number="149">      <span class="co">## date Ra cannot be earlier than date Rb</span></a>
<a class="sourceLine" id="cb1-150" data-line-number="150">      journeyUnderReview.[date Ra] =<span class="st"> </span>maximum <span class="kw">of</span> (crossing date <span class="op">+</span><span class="st"> </span>Tn <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-151" data-line-number="151"><span class="st">                       </span>AccumulatedDaysMigration) <span class="kw">and</span> (journeyUnderReview.[date Rb])</a>
<a class="sourceLine" id="cb1-152" data-line-number="152">   </a>
<a class="sourceLine" id="cb1-153" data-line-number="153">      <span class="co">## we only need to set LTM if it has not already been instant assigned </span></a>
<a class="sourceLine" id="cb1-154" data-line-number="154">      <span class="cf">if</span> journeyUnderReview.[long term migration] is not known</a>
<a class="sourceLine" id="cb1-155" data-line-number="155">         journeyUnderReview.[long term migration] =<span class="st"> </span>false</a>
<a class="sourceLine" id="cb1-156" data-line-number="156">         journeyUnderReview.[date LTM] =<span class="st"> </span>maximum <span class="kw">of</span> (crossing date <span class="op">+</span><span class="st"> </span>Tn <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-157" data-line-number="157"><span class="st">               </span>AccumulatedDaysMigration) <span class="kw">and</span>  (journeyUnderReview.[date Rb]) </a>
<a class="sourceLine" id="cb1-158" data-line-number="158"><span class="op">---</span></a></code></pre></div>
</div>
</div>
<div id="using-the-migrbc-package" class="section level1">
<h1>Using the <code>migrbc</code> Package</h1>
<p>The function ‘run_rbc’ is the main function of the package ‘migrbc’ for users to classify their migrants based on the rules defined in the algorithm section. The following table lists the parameters of the function.</p>
<div id="parameters-of-the-function-run_rbc" class="section level3">
<h3>Parameters of the Function <code>run_rbc</code>:</h3>
<div class="l-body-outset">
<table>
<colgroup>
<col width="26%"></col>
<col width="73%"></col>
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameters</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>crossing_data</code></td>
<td><code>A pre-processed group data contain journeys, movements and IRS or the raw crossing data.</code></td>
</tr>
<tr class="even">
<td><code>init_res_status_data</code></td>
<td><code>The raw data of the initial residence status in the format of data frame.</code></td>
</tr>
<tr class="odd">
<td><code>window_size</code></td>
<td><code>The maximum length of the scanning period. Can be an integer giving the number of days, the result of a call to function difftime, or an object of class Duration.</code></td>
</tr>
<tr class="even">
<td><code>threshold_year</code></td>
<td><code>The length of the yearly test period. Can be an integer giving the number of days, the result of a call to function difftime, or an object of class Duration.</code></td>
</tr>
<tr class="odd">
<td><code>parallel</code></td>
<td><code>Logical. Whether to use parallel processing, to speed up the calculation of migration statuses. Defaults to TRUE.</code></td>
</tr>
<tr class="even">
<td><code>n_core</code></td>
<td><code>The number of cores to use, if parallel is TRUE. Defaults to 2. Higher values will typically result in faster calculations on computers with more than two cores.</code></td>
</tr>
<tr class="odd">
<td><code>max_ram</code></td>
<td><code>Optional, it is used to limit the RAM that can be used by this function. The default value is 5 Gb.</code></td>
</tr>
<tr class="even">
<td><code>include_error_columns</code></td>
<td><code>Optional, if it is TRUE, the returned result of error_data will contain two extra columns error_code and error_message.</code></td>
</tr>
<tr class="odd">
<td><code>mc.cleanup</code></td>
<td><code>Optional, if set to TRUE then all children that have been forked by this function will be killed (by sending SIGTERM) before this function returns. Under normal circumstances mclapply waits for the children to deliver results, so this option usually has only effect when mclapply is interrupted. If set to FALSE then child processes are collected, but not forcefully terminated. As a special case this argument can be set to the number of the signal that should be used to kill the children instead of SIGTERM.</code></td>
</tr>
</tbody>
</table>
</div>
<p>The parameter <code>crossing_data</code> can be a dataframe object or the data outputted from the usage of the function <code>pre_process</code>. The functionality of <code>pre_process</code> is to divide a large dataset into a number of sub datasets. The function <code>pre_process</code> is useful if the raw data is extreme large, for example, if we have a data of more than 1 million records, then it is better to divide the raw data into small subsets (n_groups = 10, 10 subgroups). The following lists the parameters of the function <code>pre_process</code>.</p>
</div>
<div id="parameters-of-the-function-pre_process" class="section level3">
<h3>Parameters of the Function <code>pre_process</code>:</h3>
<table>
<colgroup>
<col width="26%"></col>
<col width="73%"></col>
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameters</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>data</code></td>
<td><code>A dataframe object</code></td>
</tr>
<tr class="even">
<td><code>init_res_status_data</code></td>
<td><code>The raw data of the initial residence status in the format of data frame.</code></td>
</tr>
<tr class="odd">
<td><code>n_groups</code></td>
<td><code>The number of sub datasets that is likely to be returned.</code></td>
</tr>
</tbody>
</table>
<p>In this document, we provide a few examples to outline the main functionalities provided by the package. The first thing we need to do is attaching the package <code>migrbc</code>, <code>knitr</code> and <code>parallel</code> to your R studio as follows:</p>
</div>
<div id="attaching-packages" class="section level2">
<h2>Attaching packages</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(migrbc)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># If using the parallel processing option (only available on UNIX like systems)</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(parallel)</a></code></pre></div>
</div>
<div id="setting-up-a-logger-optional" class="section level2">
<h2>Setting up a Logger (Optional)</h2>
<p>We applied futile.logger for troubleshooting and hence, provided an utility function for initializing the logger. More information about the logger can be found with the link (<a href="https://CRAN.R-project.org/package=futile.logger" class="uri">https://CRAN.R-project.org/package=futile.logger</a>). The parameter log_level is a number in the set of 1, 2, 4, 6, 8, and 9:</p>
<pre><code>futile.logger::FATAL: 1
futile.logger::ERROR: 2
futile.logger::WARN:  4
futile.logger::INFO:  6
futile.logger::DEBUG: 8
futile.logger::TRACE: 9</code></pre>
<p>If we would like to output the log information to a file, then you can set the parameter log_path to your own file path. By default, the log_level is set to 1 and log_path is set to NULL.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">## to suppresse log messages to the console</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">log_level &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">log_path &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">migrbc<span class="op">::</span><span class="kw">initialize_logger</span>(<span class="dt">log_level =</span> log_level,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                          <span class="dt">log_path =</span> log_path)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; logger  'migrbc' has log_level=1 and writes to the console</span></a></code></pre></div>
</div>
<div id="creating-dummy-data" class="section level2">
<h2>Creating Dummy Data</h2>
<p>We use some random made-up data, which is generated by the function setup_random_test_data in the <code>migrbc</code> package. The first argument is the number of people we would like to generate; the second argument is the initial start date; the third argument is the number of journeys a person has; <code>min</code> and <code>max</code> define the random duration gap between two journeys’ crossing dates.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">number_of_people &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">person_data &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">setup_random_test_data</span>(number_of_people, </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                                              <span class="dt">initial_date =</span> <span class="st">&quot;2001-01-01&quot;</span>, </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                                              <span class="dt">numJourneys =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                                              <span class="dt">min =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                                              <span class="dt">max =</span> <span class="dv">100</span>)</a></code></pre></div>
</div>
<div id="defining-threshold-and-test-duration" class="section level2">
<h2>Defining Threshold and Test Duration</h2>
<p>In this vignette, we use a 12/16 rule. In other words, the threshold period is 12 months, and the test period (window size) is 16 months - approximately. The “approximately” is necessary because in practice we define the threshold and test periods using days rather than months. Months are difficult to work with, since their lengths vary in complicated ways. The package defines these parameters as a number of days. Instead of 12 months we use 365 days, and instead of 16 months we use 487 days:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">## 12/16</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">## threshold value</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">dur_threshold_year &lt;-<span class="st"> </span><span class="dv">365</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">## window size</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">dur_ws &lt;-<span class="st"> </span><span class="dv">487</span></a></code></pre></div>
<p>If we prefer to process it by a <code>csv</code> file (not provided by the ‘migrbc’), which contains all required columns:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">## generate test data</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">person_temp &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">setup_random_test_data</span>(number_of_people, </a>
<a class="sourceLine" id="cb7-3" data-line-number="3">                                              <span class="dt">initial_date =</span> <span class="st">&quot;2001-01-01&quot;</span>, </a>
<a class="sourceLine" id="cb7-4" data-line-number="4">                                              <span class="dt">numJourneys =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">                                              <span class="dt">min =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb7-6" data-line-number="6">                                              <span class="dt">max =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">## write to a temp file</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">temp_path &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">utils<span class="op">::</span><span class="kw">write.csv</span>(person_temp, </a>
<a class="sourceLine" id="cb7-10" data-line-number="10">                 <span class="dt">file =</span> <span class="kw">file.path</span>(temp_path, <span class="st">&quot;data1.csv&quot;</span>), </a>
<a class="sourceLine" id="cb7-11" data-line-number="11">                 <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">## read in files using the fread function from the data.table package</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">person_data &lt;-<span class="st"> </span>utils<span class="op">::</span><span class="kw">read.csv</span>(<span class="kw">file.path</span>(temp_path, <span class="st">&quot;data1.csv&quot;</span>),</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">                               <span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="kw">kable</span>(<span class="kw">head</span>(person_data[, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)]))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">journeyId</th>
<th align="right">personId</th>
<th align="right">is_arrival</th>
<th align="left">date_crossing</th>
<th align="right">journey_sequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-01-01</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">2001-01-21</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-02-12</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">2001-03-10</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2001-04-12</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">2001-05-20</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
</div>
<div id="pre-process-rbc" class="section level2">
<h2>Pre-process RBC</h2>
<p>As mentioned in the beginning of this section, this process is ‘optional’ if we want to divide the input data into very small subgroups. It is useful to save memory space for a very large dataset (see Case 1-1). If we choose not to divide the data into a custom size of subgroups, we can pass the person_data directly to the main function, i.e., the main function for process RBC (see Case 1-2).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">n_groups &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">pre_processed_data &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">pre_process</span>(person_data, </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                                         <span class="dt">n_groups =</span> n_groups)</a></code></pre></div>
</div>
<div id="process-rbc" class="section level2">
<h2>Process RBC</h2>
<div id="case-1-1-classifying-rules-with-divided-sub-datasets-pre-processed" class="section level3">
<h3>Case 1-1: classifying rules with divided sub-datasets (pre-processed)</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">## run in non-parallel</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">res &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">run_rbc</span>(pre_processed_data, </a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                       <span class="dt">window_size =</span> dur_ws, </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                       <span class="dt">threshold_year =</span> dur_threshold_year, </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">                       <span class="dt">parallel=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">## run in parallel</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">res &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">run_rbc</span>(pre_processed_data, </a>
<a class="sourceLine" id="cb9-9" data-line-number="9">                       <span class="dt">window_size =</span> dur_ws, </a>
<a class="sourceLine" id="cb9-10" data-line-number="10">                       <span class="dt">threshold_year =</span> dur_threshold_year, </a>
<a class="sourceLine" id="cb9-11" data-line-number="11">                       <span class="dt">parallel=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">                       <span class="dt">n_core =</span> <span class="dv">2</span>)</a></code></pre></div>
<p>The main function <code>run_rbc</code> can process raw data (a data frame object) directly if there is no need to create your own number of subgroups. In this case, the function <code>run_rbc</code> will divide the raw data with n_groups = n_core.</p>
</div>
<div id="case-1-2-classifying-rules-with-raw-data-non-pre-processed" class="section level3">
<h3>Case 1-2: classifying rules with raw data (non-pre-processed)</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">## run in non-parallel with the raw data i.e., the person_data directly</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">res &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">run_rbc</span>(person_data, </a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                       <span class="dt">window_size =</span> dur_ws, </a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                       <span class="dt">threshold_year =</span> dur_threshold_year, </a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                       <span class="dt">parallel=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">## run in parallel with the raw data i.e., the person_data directly</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">res &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">run_rbc</span>(person_data, </a>
<a class="sourceLine" id="cb10-9" data-line-number="9">                       <span class="dt">window_size =</span> dur_ws, </a>
<a class="sourceLine" id="cb10-10" data-line-number="10">                       <span class="dt">threshold_year =</span> dur_threshold_year, </a>
<a class="sourceLine" id="cb10-11" data-line-number="11">                       <span class="dt">parallel=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">                       <span class="dt">n_core =</span> <span class="dv">2</span>)</a></code></pre></div>
</div>
</div>
<div id="post-process" class="section level2">
<h2>Post-process</h2>
<p>The result returned from the function run_rbc (<code>migrbc</code>) contains two lists of person instances, i.e., good people list without error and bad people list with error.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">## good result</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">kable</span>(<span class="kw">head</span>(res<span class="op">$</span>journeys[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>)]))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">journeyId</th>
<th align="right">personId</th>
<th align="right">res_status_before</th>
<th align="right">res_status_after</th>
<th align="right">is_long_term_mig</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="including-error-columns" class="section level2">
<h2>Including error columns</h2>
<div id="case-2-1216-small-made-up-data-with-error" class="section level3">
<h3>Case 2: 12/16 small made up data with error</h3>
<p>By default, the option ‘include_error_columns’ is FALSE. To view the columns ‘error_code’ and ‘error_message’ in the ‘error_data’, we need to set the option ‘include_error_columns’ to TRUE.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">## set up a test data with two person</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">## a person with bad journeys</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">j1 &lt;-<span class="st">       </span><span class="kw">c</span>(<span class="dt">journeyId =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb12-4" data-line-number="4">              <span class="dt">personId =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb12-5" data-line-number="5">              <span class="dt">is_arrival =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb12-6" data-line-number="6">              <span class="dt">date_crossing =</span> <span class="st">&quot;2014-02-13&quot;</span>, </a>
<a class="sourceLine" id="cb12-7" data-line-number="7">              <span class="dt">journey_sequence =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">              <span class="dt">journeyId_prev =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">j2 &lt;-<span class="st">       </span><span class="kw">c</span>(<span class="dt">journeyId =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb12-10" data-line-number="10">              <span class="dt">personId =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb12-11" data-line-number="11">              <span class="dt">is_arrival =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb12-12" data-line-number="12">              <span class="dt">date_crossing =</span> <span class="st">&quot;2014-02-26&quot;</span>, </a>
<a class="sourceLine" id="cb12-13" data-line-number="13">              <span class="dt">journey_sequence =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">              <span class="dt">journeyId_prev =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">j3 &lt;-<span class="st">       </span><span class="kw">c</span>(<span class="dt">journeyId =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb12-16" data-line-number="16">              <span class="dt">personId =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb12-17" data-line-number="17">              <span class="dt">is_arrival =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb12-18" data-line-number="18">              <span class="dt">date_crossing =</span> <span class="st">&quot;2014-02-13&quot;</span>, </a>
<a class="sourceLine" id="cb12-19" data-line-number="19">              <span class="dt">journey_sequence =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb12-20" data-line-number="20">              <span class="dt">journeyId_prev =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb12-21" data-line-number="21">j4 &lt;-<span class="st">       </span><span class="kw">c</span>(<span class="dt">journeyId =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb12-22" data-line-number="22">              <span class="dt">personId =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb12-23" data-line-number="23">              <span class="dt">is_arrival =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb12-24" data-line-number="24">              <span class="dt">date_crossing =</span> <span class="st">&quot;2014-02-26&quot;</span>, </a>
<a class="sourceLine" id="cb12-25" data-line-number="25">              <span class="dt">journey_sequence =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb12-26" data-line-number="26">              <span class="dt">journeyId_prev =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-27" data-line-number="27"></a>
<a class="sourceLine" id="cb12-28" data-line-number="28"><span class="co">## initial residence status data</span></a>
<a class="sourceLine" id="cb12-29" data-line-number="29">i1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">personId =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb12-30" data-line-number="30">        <span class="dt">res_status_initial =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb12-31" data-line-number="31">        <span class="dt">date_finalised =</span> <span class="st">&quot;2017-01-01&quot;</span>)</a>
<a class="sourceLine" id="cb12-32" data-line-number="32">i2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">personId =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb12-33" data-line-number="33">        <span class="dt">res_status_initial =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb12-34" data-line-number="34">        <span class="dt">date_finalised =</span> <span class="st">&quot;2017-01-01&quot;</span>)</a>
<a class="sourceLine" id="cb12-35" data-line-number="35"></a>
<a class="sourceLine" id="cb12-36" data-line-number="36">person_data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">rbind</span>(j1, j2, j3, j4 ),</a>
<a class="sourceLine" id="cb12-37" data-line-number="37">                             <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb12-38" data-line-number="38">ini_data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">rbind</span>(i1, i2), <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)  </a>
<a class="sourceLine" id="cb12-39" data-line-number="39">post_data &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">run_rbc</span>(person_data,</a>
<a class="sourceLine" id="cb12-40" data-line-number="40">                             <span class="dt">init_res_status_data =</span> ini_data,</a>
<a class="sourceLine" id="cb12-41" data-line-number="41">                             <span class="dt">window_size =</span> <span class="dv">487</span>, </a>
<a class="sourceLine" id="cb12-42" data-line-number="42">                             <span class="dt">threshold_year =</span> <span class="dv">365</span>,</a>
<a class="sourceLine" id="cb12-43" data-line-number="43">                             <span class="dt">include_error_columns =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-44" data-line-number="44"></a>
<a class="sourceLine" id="cb12-45" data-line-number="45"><span class="co">## good result</span></a>
<a class="sourceLine" id="cb12-46" data-line-number="46"><span class="kw">kable</span>(<span class="kw">head</span>(post_data<span class="op">$</span>journeys[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>)]))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">journeyId</th>
<th align="right">personId</th>
<th align="right">res_status_before</th>
<th align="right">res_status_after</th>
<th align="right">is_long_term_mig</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>4</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">## bad result</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">kable</span>(<span class="kw">head</span>(post_data<span class="op">$</span>error_data[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">14</span>, <span class="dv">15</span>)]))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">journeyId</th>
<th align="right">personId</th>
<th align="right">error_code</th>
<th align="left">error_message</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">‘is_arrival’ cannot be identical to previous one.</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">‘is_arrival’ cannot be identical to previous one.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>The goal of this document is to provide comprehensive examples to guide potential users to use the package effectively and efficiently. Some background information and the main algorithm are introduced. All information provided belongs to Stats NZ.</p>
</div>
<div id="appendix---plots-of-migration-histories" class="section level1">
<h1>Appendix - Plots of migration histories</h1>
<p>Package <code>migrbc</code> contains a function called <code>plot_mig_hist</code> for plotting migration histories. Plots for the one person in random are generated as follows:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">plot_test &lt;-<span class="st"> </span><span class="cf">function</span>(mig_hist) {</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  <span class="kw">plot_mig_hist</span>(<span class="dt">date_crossing =</span> <span class="kw">as.character</span>(mig_hist<span class="op">$</span>date_crossing), </a>
<a class="sourceLine" id="cb14-3" data-line-number="3">                <span class="dt">is_arrival =</span> mig_hist<span class="op">$</span>is_arrival,</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">                <span class="dt">days_to_next_crossing =</span> mig_hist<span class="op">$</span>days_to_next_crossing,</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">                <span class="dt">show_date =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb14-6" data-line-number="6">                <span class="dt">cex =</span> <span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">number_of_people &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9">person_data &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">setup_random_test_data</span>(number_of_people, </a>
<a class="sourceLine" id="cb14-10" data-line-number="10">                                              <span class="dt">initial_date =</span> <span class="st">&quot;2001-01-01&quot;</span>, </a>
<a class="sourceLine" id="cb14-11" data-line-number="11">                                              <span class="dt">numJourneys =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">                                              <span class="dt">min =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb14-13" data-line-number="13">                                              <span class="dt">max =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">## run in non-parallel</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15">post_data &lt;-<span class="st"> </span>migrbc<span class="op">::</span><span class="kw">run_rbc</span>(person_data, </a>
<a class="sourceLine" id="cb14-16" data-line-number="16">                       <span class="dt">window_size =</span> <span class="dv">487</span>, </a>
<a class="sourceLine" id="cb14-17" data-line-number="17">                       <span class="dt">threshold_year =</span> <span class="dv">365</span>, </a>
<a class="sourceLine" id="cb14-18" data-line-number="18">                       <span class="dt">parallel=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">## plot good result</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20">old_par &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="kw">plot_test</span>(post_data<span class="op">$</span>journeys)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">par</span>(old_par)</a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
